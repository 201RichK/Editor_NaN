<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
<div id="app">
  <div class="editor">
    <div style="flex:2">
      <div style="height: 400px">
        <editor editor-id="editorA" :content="contentA" v-on:change-content="changeContentA" ></editor>
      </div>
      <button :disabled="codesend" type="submit"  @click="getcontentA">Run</button>

    </div>
    <div class="info" style="flex:1">
      <ul>
        <li>Sujet: {{ .exercice.Sujet }}</li>
        <li>Result: {{ .exercice.Success }}</li>
      </ul>
      <div class="console">
        <p > <span class="a"><b class="editorA">NaN_Editor</b class="b"> #:</span><div v-if="codesend" class="lds-ellipsis"><div></div><div></div><div></div><div></div></div>${ cons }
        </p>
      </div>
    </div>
  </div>
</div>

<div class="timelineDiv">
  <div class="">
    <div class="Timeline">

      <svg height="5" width="200">
        <line x1="0" y1="0" x2="200" y2="0" style="stroke:#004165;stroke-width:5" />
        Sorry, your browser does not support inline SVG.
      </svg>

      <div class="event1">

        <div class="event1Bubble">
          <div class="eventTime">
            <div class="DayDigit">02</div>
            <div class="Day">
              Run
              <div class="MonthYear">Exo 1</div>
            </div>
            <div class="DayDigit">02</div>
            <div class="Day">
              Run
              <div class="MonthYear">Exo 1</div>
            </div>
          </div>
        </div>
        <div class="eventAuthor">John Doe succed with 4s runtime</div>
        <svg height="20" width="20">
          <circle cx="10" cy="11" r="5" fill="#004165" />
        </svg>
        <div class="time">4s runtime</div>

      </div>

      <svg height="5" width="300">
        <line x1="0" y1="0" x2="300" y2="0" style="stroke:#004165;stroke-width:5" />
        Sorry, your browser does not support inline SVG.
      </svg>

      <div class="event2">

        <div class="event2Bubble">
          <div class="eventTime">
            <div class="DayDigit">17</div>
            <div class="Day">
              Run
              <div class="MonthYear">Exo2</div>
            </div>
            <div class="DayDigit">17</div>
            <div class="Day">
              Run
              <div class="MonthYear">Exo2</div>
            </div>
          </div>
        </div>
        <div class="event2Author">john Doe Succed with 5s runtime</div>
        <svg height="20" width="20">
          <circle cx="10" cy="11" r="5" fill="#004165" />
        </svg>
        <div class="time2">09s runtime</div>
      </div>

      <svg height="5" width="50">
        <line x1="0" y1="0" x2="50" y2="0" style="stroke:#004165;stroke-width:5" />
        Sorry, your browser does not support inline SVG.
      </svg>

      <div class="now">
        NOW
      </div>


      <svg height="5" width="150">
        <line x1="0" y1="0" x2="150" y2="0" style="stroke:rgba(162, 164, 163, 0.37);stroke-width:5" />
        Sorry, your browser does not support inline SVG.
      </svg>
      <div class="event3 futureGray ">
        <div class="event1Bubble futureOpacity">
          <div class="eventTime">
            <div class="DayDigit">05</div>
            <div class="Day">
              Tuesday
              <div class="MonthYear">May 2016</div>
            </div>
          </div>
          <div class="eventTitle">Anticipated Hire</div>
        </div>
        <svg height="20" width="20">
          <circle cx="10" cy="11" r="5" fill="rgba(162, 164, 163, 0.37)" />
        </svg>
      </div>
      <svg height="5" width="50">
        <line x1="0" y1="0" x2="50" y2="0" style="stroke:#004165;stroke-width:5" />
      </svg>
      <svg height="20" width="42">
        <line x1="1" y1="0" x2="1" y2="20" style="stroke:#004165;stroke-width:2" />
        <circle cx="11" cy="10" r="3" fill="#004165" />
        <circle cx="21" cy="10" r="3" fill="#004165" />
        <circle cx="31" cy="10" r="3" fill="#004165" />
        <line x1="41" y1="0" x2="41" y2="20" style="stroke:#004165;stroke-width:2" />
      </svg>

    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://rawgit.com/ajaxorg/ace-builds/master/src-min-noconflict/ace.js"></script>
<script src="./static/js/axios.min.js"></script>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script>
  Vue.component('Editor', {
    template: '<div :id="editorId" style="width: 100%; height: 100%;"></div>',
    props: ['editorId', 'content', 'lang', 'theme'],
    data () {
      return {
        editor: Object,
        beforeContent: ''
      }
    },
    watch: {
      'content' (value) {
        if (this.beforeContent !== value) {
          this.editor.setValue(value, 1)
        }
      }
    },
    mounted () {
      const lang = this.lang || 'python'
      const theme = this.theme || 'ambiance'

      this.editor = window.ace.edit(this.editorId)
      this.editor.setValue(this.content, 1)

      // mode-xxx.js or theme-xxx.jsがある場合のみ有効
      this.editor.getSession().setMode(`ace/mode/${lang}`)
      this.editor.setTheme(`ace/theme/${theme}`)
      this.editor.on('change', () => {
        this.beforeContent = this.editor.getValue()
        this.$emit('change-content', this.editor.getValue())
      })
    }
  })
  const app = new Vue({
    el: "#app",
    data () {
      return {
        contentA: '{{ println .exercice.Program}}',
        //   contentB: 'default content for Editor B'
        base_usl: 'http://127.0.0.1:8080',
        cons : "",
        codesend: false,
        code: '',
      }
    },
    delimiters: ["${", "}"],

    methods: {
      reset () {
        this.contentA = 'reset content for Editor A'
        //   this.contentB = 'reset content for Editor B'

      },

      changeContentA (val) {
        if (this.contentA !== val) {
          this.contentA = val
        }
      },

      getcontentA(){
        console.log(this.contentA)
        this.sendcode(this.contentA)
      },


      sendcode(exoid) {
        // this.editor = window.ace.edit('editor')
        this.cons = "";
        this.codesend = true;
        //code = this.editor.getValue()

        let data = JSON.stringify({
          source_code: exoid,

        })



        axios.post(this.base_usl + '/send', data, {
          headers: {
            'Content-Type': 'application/json',
          }
        }).then((response) => {
          //let resultats = JSON.parse(response.data)
          console.log(response.data);
          this.cons = "time: " + response.data.time + "\n" + "result: " + response.data.stdout
          this.codesend = false;

        }).catch((err) => {
          console.log(err);
          this.codesend = false;
        })
      },

      // changeContentB (val) {
      // 	if (this.contentB !== val) {
      //   	this.contentB = val
      //   }
      // }
    }
  })
</script>
</body>
</html>
